import{_ as B,c as m,e as k,o as h,j as r,a1 as f,n as b,aj as g,b as D,J as F,ak as v,w as L,G as w,H as x,P as M,al as E,t as I,am as X,T as R,ah as Y,an as z,ao as P}from"./framework.zNPsoP7e.js";const A={name:"hevue-img-preview",data(){return{vue:z,showHevueImgRotate:!1,visible:!1,imgScale:1,imgTop:0,imgLeft:0,imgRotate:0,isFull:!1,maxWH:{"max-width":"100%","max-height":"100%"},clientX:0,clientY:0,imgIndex:0,canRun:!0,imgurl:"",imgState:1,start:[{},{}],fromIndex:0,mobileScale:0,imgList:[],nowImgIndex:0,thumbnail:!0,controlBar:[],closeBtn:!0,arrowBtn:!0,keyboard:!0,clickMaskCLose:!0,closeFn:null,changeFn:null,customStyle:{},themeName:"glass",disabledImgRightClick:!1,showTranstion:!1,needLoadImg:[],showHevueImgHelp:!1,locale:"zhCN",shortI18n:{zhCN:{key27:"退出预览",key65:"上一张",key68:"下一张",key87:"放大",key83:"缩小",key37:"上一张",key39:"下一张",key38:"放大",key40:"缩小",key81:"逆时针旋转",key69:"顺时针旋转",key82:"重置旋转"},en:{key27:"Exit preview",key65:"Previous",key68:"Next",key87:"Zoom in",key83:"Zoom out",key37:"Previous",key39:"Next",key38:"Zoom in",key40:"Zoom out",key81:"Rotate counterclockwise",key69:"Rotate clockwise",key82:"Reset rotation"}},shortcutList:[{keyNum:27,keyName:"Esc",desc:"key27",handle:()=>{this.close({way:"esc"})}},{keyNum:65,keyName:"A",desc:"key65",handle:()=>{this.multiple&&this.prevNextHandle(!1,"key-a")}},{keyNum:68,keyName:"D",desc:"key68",handle:()=>{this.multiple&&this.prevNextHandle(!0,"key-d")}},{keyNum:87,keyName:"W",desc:"key87",handle:()=>{this.scaleFunc(.15)}},{keyNum:83,keyName:"S",desc:"key83",handle:()=>{this.scaleFunc(-.15)}},{keyNum:37,keyName:"←",desc:"key37",handle:()=>{this.multiple&&this.prevNextHandle(!1,"key-left")}},{keyNum:39,keyName:"→",desc:"key39",handle:()=>{this.multiple&&this.prevNextHandle(!0,"key-right")}},{keyNum:38,keyName:"↑",desc:"key38",handle:()=>{this.scaleFunc(.15)}},{keyNum:40,keyName:"↓",desc:"key40",handle:()=>{this.scaleFunc(-.15)}},{keyNum:81,keyName:"Q",desc:"key81",handle:()=>{this.rotateFunc(-90)}},{keyNum:69,keyName:"E",desc:"key69",handle:()=>{this.rotateFunc(90)}},{keyNum:82,keyName:"R",desc:"key82",handle:()=>{this.initImg()}}],controlbarI18n:{zhCN:{zoomOut:"缩小",zoomIn:"放大",rotateLeft:"向左旋转",customRotate:"自定义旋转",rotateRight:"向右旋转",reset:"复位",prev:"上一个",next:"下一个",download:"下载",help:"帮助"},en:{zoomOut:"Zoom Out",zoomIn:"Zoom In",rotateLeft:"Rotate Left",customRotate:"Custom Rotate",rotateRight:"Rotate Right",reset:"Reset",prev:"Prev",next:"Next",download:"Download",help:"Help"}},controlbarAllItems:[{key:"zoomOut",icon:"&#xe65e;",title:"zoomOut",show:()=>!0,handle:()=>{this.scaleFunc(-.15)}},{key:"zoomIn",icon:"&#xe65d;",title:"zoomIn",show:()=>!0,handle:()=>{this.scaleFunc(.15)}},{key:"rotateLeft",icon:"&#xe662;",title:"rotateLeft",show:()=>!0,handle:()=>{this.rotateFunc(-90)}},{key:"customRotate",icon:"&#xe927;",title:"customRotate",show:()=>!0,handle:()=>{this.showHevueImgRotate=!this.showHevueImgRotate}},{key:"rotateRight",icon:"&#xe663;",title:"rotateRight",show:()=>!0,handle:()=>{this.rotateFunc(90)}},{key:"reset",icon:"&#xe86b;",title:"reset",show:()=>!0,handle:()=>{this.initImg()}},{key:"prev",icon:"&#xe62f;",title:"prev",show:()=>()=>this.multiple,handle:()=>{this.prevNextHandle(!1,"control-bar")}},{key:"next",icon:"&#xe62e;",title:"next",show:()=>()=>this.multiple,handle:()=>{this.prevNextHandle(!0,"control-bar")}},{key:"download",icon:"&#xe694;",title:"download",show:()=>!0,handle:()=>{this.downloadIamge()}},{key:"help",icon:"&#xe626;",title:"help",show:()=>this.keyboard,handle:()=>{this.showHevueImgHelp=!this.showHevueImgHelp}}]}},created(){},mounted(){this.initImg()},computed:{vueVersion(){return parseInt(this.vue.version)},controlbarShowItems(){return this.controlBar.map(e=>this.controlbarAllItems.find(s=>s.key===e))},multiple(){return Array.isArray(this.imgList)&&this.imgList.length>1},getImgPostion(){return{...this.maxWH,transform:`scale(${this.imgScale}) rotate(${this.imgRotate}deg)`,marginTop:this.imgTop+"px",marginLeft:this.imgLeft+"px"}}},watch:{customStyle:{handler(e){let t=Object.entries(e);this.$nextTick(()=>{t.length>0&&t.forEach(s=>{let l=s[0],i=s[1],n=document.querySelector(".hevue-imgpreview-wrap");n&&n.style.setProperty(l,i)})})},immediate:!0,deep:!0},url(){this.initImg()},visible:{handler(e){e&&this.$nextTick(()=>{let t=document.getElementById("hevue-imgpreview-wrap");t.onmousewheel=this.scrollFunc,document.body.addEventListener("DOMMouseScroll",this.scrollFunc),document.ondragstart=function(){return!1},this.themeName&&t.classList.add(this.themeName),this.disableTransition&&t.classList.add("disableTransition"),Array.isArray(this.controlBar)?this.controlBar.length===0&&(this.controlBar=this.controlbarAllItems.map(s=>s.key)):this.controlBar=[],this.url&&(!this.imgList||this.imgList.length===0)&&(this.imgList=[this.url]),this.imgIndex=Number(this.nowImgIndex)||0,this.changeUrl(this.imgList[this.imgIndex],this.imgIndex),this.keyboard&&document.addEventListener("keydown",this.keyHandleDebounce)})},immediate:!0}},methods:{show(){this.visible=!0,setTimeout(()=>{this.showTranstion=!0},20)},close(e){this.showTranstion=!1,setTimeout(()=>{this.initImg(),document.body.removeEventListener("DOMMouseScroll",this.scrollFunc),document.ondragstart=null,this.keyboard&&document.removeEventListener("keydown",this.keyHandleDebounce),this.visible=!1,this.closeFn&&this.closeFn(e),this.showHevueImgHelp=!1,this.imgList=[]},500)},initImg(){this.mobileScale=1,this.imgScale=1,this.imgRotate=0,this.imgTop=0,this.imgLeft=0},imgContextMenu(e){e=e||window.event,this.disabledImgRightClick&&e.preventDefault()},prevNextHandle(e,t){let s=0;e?(s=this.imgIndex+1,s>this.imgList.length-1&&(s=0)):(s=this.imgIndex-1,s<0&&(s=this.imgList.length-1)),this.toogleImg(s,t,e)},toogleImg(e,t,s){if(this.imgIndex===e)return;this.fromIndex=this.imgIndex;let l=this.imgIndex;this.imgIndex=e;let i=t=="thumb"?"thumb":s?"next":"prev";this.changeFn&&this.changeFn({type:i,fromImgIndex:l,fromImgUrl:this.imgList[l],toImgIndex:this.imgIndex,toImgUrl:this.imgList[this.imgIndex],way:t}),this.changeUrl(this.imgList[this.imgIndex],this.imgIndex)},changeUrl(e,t){this.needLoadImg.find(l=>l.index==t)?this.imgState=2:(this.imgState=1,this.needLoadImg.push({url:e,index:t}),this.$nextTick(()=>{let l=this.$refs["heImg"+t][0];l.onload=()=>{t!=null&&t==this.imgIndex?this.imgState=2:t==null&&(this.imgState=2)},l.onerror=()=>{t!=null&&t==this.imgIndex?this.imgState=3:t==null&&(this.imgState=3)}}))},getThumbLeft(){return-(this.imgIndex*100+50)},rotateFunc(e){let t=+this.imgRotate+e;t>360?t=t-360:t<0&&(t=360+t),this.imgRotate=t},scaleFunc(e,t){this.imgScale<=.2&&e<0||(t?this.imgScale=e:this.imgScale+=e)},imgToggle(){this.initImg(),this.isFull?this.maxWH={"max-width":"100%","max-height":"100%"}:this.maxWH="",this.isFull=!this.isFull},scrollFunc(e){e=e||window.event,e.delta=e.wheelDelta||-e.detail,e.preventDefault(),e.delta>0&&this.scaleFunc(.05),e.delta<0&&this.scaleFunc(-.05)},addMove(e){e=e||window.event,this.clientX=e.clientX,this.clientY=e.clientY,this.$refs.heImg.onmousemove=this.moveFunc},addMoveMobile(e){e.preventDefault(),e=e||window.event,e.touches.length>1?this.start=e.touches:(this.clientX=e.touches[0].pageX,this.clientY=e.touches[0].pageY),this.$refs.heImg.ontouchmove=this.moveFuncMobile},moveFunc(e){e=e||window.event,e.preventDefault();let t=e.clientX-this.clientX,s=e.clientY-this.clientY;this.imgLeft+=t*2,this.imgTop+=s*2,this.clientX=e.clientX,this.clientY=e.clientY},moveFuncMobile(e){if(e=e||window.event,e.touches.length>1){var t=e.touches,s=this.getDistance(t[0],t[1])/this.getDistance(this.start[0],this.start[1]);this.mobileScale?s>1?this.scaleFunc(s+this.mobileScale-1,!0):this.scaleFunc(s*this.mobileScale,!0):this.scaleFunc(s,!0)}else{let l=e.touches[0];e.preventDefault();let i=l.pageX-this.clientX,n=l.pageY-this.clientY;this.imgLeft+=i*2,this.imgTop+=n*2,this.clientX=l.pageX,this.clientY=l.pageY}},removeMove(e){e==="pc"?this.$refs.heImg.onmousemove=null:(this.mobileScale=this.imgScale,this.$refs.heImg.ontouchmove=null)},keyHandleDebounce(e){this.canRun&&(this.keyHandle(e),this.canRun=!1,setTimeout(()=>{this.canRun=!0},100))},keyHandle(e){e=window.event||e;var t=e.keyCode||e.which||e.charCode;let s=this.shortcutList.find(l=>l.keyNum===t);s&&s.handle()},clickMask(){this.clickMaskCLose&&this.close({way:"mask"})},getDistance(e,t){var s=t.pageX-e.pageX,l=t.pageY-e.pageY;return Math.sqrt(s*s+l*l)},downloadIamge(){let e=new Image;e.setAttribute("crossOrigin","anonymous"),e.onload=function(){let t=document.createElement("canvas");t.width=e.width,t.height=e.height,t.getContext("2d").drawImage(e,0,0,e.width,e.height);let l=t.toDataURL("image/png"),i=document.createElement("a"),n=new MouseEvent("click");i.download="photo"+ +new Date,i.href=l,i.dispatchEvent(n)},e.onerror=function(t){console.log("图片信息不正确或图片服务器禁止访问"),console.log(t)},e.src=this.imgList[this.imgIndex]},isValidColor(e,t,s,l){if(l<128)return!1;const i=(e+t+s)/3;return!(i>240||i<15)},getDominantColorWithFilter(e){const t=document.createElement("canvas"),s=t.getContext("2d"),l=100,i=Math.min(l/e.naturalWidth,l/e.naturalHeight,1);t.width=e.width*i,t.height=e.height*i,s.drawImage(e,0,0);const o=s.getImageData(0,0,t.width,t.height).data,a={};let u=0,d="";for(let c=0;c<o.length;c+=4){const C=o[c],N=o[c+1],S=o[c+2],T=o[c+3];if(!this.isValidColor(C,N,S,T))continue;const p=`${C},${N},${S}`;a[p]=(a[p]||0)+1,a[p]>u&&(u=a[p],d=p)}const y=document.querySelector(".hevue-imgpreview-wrap.glass");return y.style.setProperty("--hevueimg-main-text-color",`rgb(${d}, .7)`),y.style.setProperty("--hevueimg-main-text-color",`rgb(${d}, .5)`),d},rgbToHsl(e,t,s){e/=255,t/=255,s/=255;const l=Math.max(e,t,s),i=Math.min(e,t,s);let n,o,a=(l+i)/2;if(l===i)n=o=0;else{const u=l-i;switch(o=a>.5?u/(2-l-i):u/(l+i),l){case e:n=(t-s)/u+(t<s?6:0);break;case t:n=(s-e)/u+2;break;case s:n=(e-t)/u+4;break}n/=6}return[n*360,o,a]},hslToRgb(e,t,s){e/=360;let l,i,n;if(t===0)l=i=n=s;else{const o=(d,y,c)=>(c<0&&(c+=1),c>1&&(c-=1),c<.16666666666666666?d+(y-d)*6*c:c<.5?y:c<.6666666666666666?d+(y-d)*(.6666666666666666-c)*6:d),a=s<.5?s*(1+t):s+t-s*t,u=2*s-a;l=o(u,a,e+1/3),i=o(u,a,e),n=o(u,a,e-1/3)}return[Math.round(l*255),Math.round(i*255),Math.round(n*255)]},adjustColor(e,t=.5){const[s,l]=this.rgbToHsl(...e);return this.hslToRgb(s,l,t)}}},O={class:"heimgfont hevue-img-status-icon rotate-animation"},G=["src"],V=["src"],W={class:"heimgfont hevue-img-status-icon"},U={class:"he-bottom-wrap"},j={class:"hevue-custom-rotate-wrap"},_={class:"hevue-custom-range-label theme-item"},Z=["onClick","innerHTML","title"],q={class:"he-imglist-wrap"},J=["onClick"],Q=["src"],K={key:1,class:"he-control-num theme-item"},$={class:"hevue-img-help-wrap theme-item"},ee={class:"hevue-img-help-item-label"},te={class:"hevue-img-help-item-desc"},ie={style:{display:"none"}};function se(e,t,s,l,i,n){return i.visible?(h(),m("div",{key:0,class:"hevue-imgpreview-wrap",id:"hevue-imgpreview-wrap",ref:"heImg",onMouseup:t[15]||(t[15]=o=>n.removeMove("pc")),onTouchend:t[16]||(t[16]=o=>n.removeMove("mobile"))},[r("div",{class:b(["hevue-img-mask",{heShow:i.showTranstion}]),onClick:t[0]||(t[0]=f((...o)=>n.clickMask&&n.clickMask(...o),["stop"]))},null,2),r("div",{class:b(["he-img-wrap",{heShow:i.showTranstion}])},[g(r("div",O,"  ",512),[[v,i.imgState===1]]),n.vueVersion>2?(h(),D(E,{key:0,name:"fade"},{default:L(()=>[(h(!0),m(w,null,x(i.needLoadImg,o=>g((h(),m("img",{src:o.url,onClick:t[1]||(t[1]=f(()=>{},["stop"])),key:o.index,ref_for:!0,ref:"heImg"+o.index,class:"he-img-view",style:M([i.imgIndex,i.fromIndex].includes(o.index)?n.getImgPostion:i.maxWH),onContextmenu:t[2]||(t[2]=(...a)=>n.imgContextMenu&&n.imgContextMenu(...a)),onMousedown:t[3]||(t[3]=(...a)=>n.addMove&&n.addMove(...a)),onTouchstart:t[4]||(t[4]=(...a)=>n.addMoveMobile&&n.addMoveMobile(...a))},null,44,G)),[[v,i.imgState===2&&i.imgIndex==o.index]])),128))]),_:1})):(h(!0),m(w,{key:1},x(i.needLoadImg,o=>g((h(),m("img",{src:o.url,onClick:t[5]||(t[5]=f(()=>{},["stop"])),key:o.index,ref_for:!0,ref:"heImg"+o.index,class:"he-img-view",style:M([i.imgIndex,i.fromIndex].includes(o.index)?n.getImgPostion:i.maxWH),onContextmenu:t[6]||(t[6]=(...a)=>n.imgContextMenu&&n.imgContextMenu(...a)),onMousedown:t[7]||(t[7]=(...a)=>n.addMove&&n.addMove(...a)),onTouchstart:t[8]||(t[8]=(...a)=>n.addMoveMobile&&n.addMoveMobile(...a))},null,44,V)),[[v,i.imgState===2&&i.imgIndex==o.index]])),128)),g(r("div",W,"  ",512),[[v,i.imgState===3]]),i.closeBtn?(h(),m("div",{key:2,class:"heimgfont he-close-icon theme-item",onClick:t[9]||(t[9]=f(o=>n.close({way:"closeBtn"}),["stop"]))},t[17]||(t[17]=[r("span",null,"",-1)]))):k("",!0),i.arrowBtn&&n.multiple?(h(),m("div",{key:3,class:"arrow arrow-left heimgfont theme-item",onClick:t[10]||(t[10]=f(o=>n.prevNextHandle(!1,"arrow-btn"),["stop"]))},t[18]||(t[18]=[r("span",null,"",-1)]))):k("",!0),i.arrowBtn&&n.multiple?(h(),m("div",{key:4,class:"arrow arrow-right heimgfont theme-item",onClick:t[11]||(t[11]=f(o=>n.prevNextHandle(!0,"arrow-btn"),["stop"]))},t[19]||(t[19]=[r("span",null,"",-1)]))):k("",!0),r("div",U,[F(R,{name:"fade"},{default:L(()=>[g(r("div",j,[r("span",_,[r("span",null,I(i.imgRotate)+"°",1)]),g(r("input",{class:"hevue-custom-range theme-item","onUpdate:modelValue":t[12]||(t[12]=o=>i.imgRotate=o),type:"range",id:"vol",min:"0",max:"360",orient:"vertical"},null,512),[[X,i.imgRotate,void 0,{number:!0}]])],512),[[v,i.showHevueImgRotate]])]),_:1}),i.controlBar.length?(h(),m("div",{key:0,onClick:t[13]||(t[13]=f(()=>{},["stop"])),class:"he-control-bar theme-item"},[(h(!0),m(w,null,x(n.controlbarShowItems,(o,a)=>g((h(),m("div",{class:"he-control-btn heimgfont",key:a,onClick:f(u=>o.handle(),["stop"]),innerHTML:o.icon,title:i.controlbarI18n[i.locale][o.title]},null,8,Z)),[[v,o.show()]])),128))])):k("",!0),g(r("div",q,[r("div",{class:"he-imglist",style:M({left:n.getThumbLeft()+"px"})},[(h(!0),m(w,null,x(i.imgList,(o,a)=>(h(),m("div",{class:b(["he-img-item",{active:a==i.imgIndex}]),key:a,onClick:u=>n.toogleImg(a,"thumb")},[r("img",{src:o,class:"he-img-item-img",onContextmenu:t[14]||(t[14]=(...u)=>n.imgContextMenu&&n.imgContextMenu(...u))},null,40,Q)],10,J))),128))],4)],512),[[v,i.thumbnail&&n.multiple]]),i.controlBar.length&&n.multiple?(h(),m("div",K,[r("span",null,I(i.imgIndex+1)+" / "+I(i.imgList.length),1)])):k("",!0)]),F(R,{name:"fade"},{default:L(()=>[g(r("div",$,[(h(!0),m(w,null,x(i.shortcutList,o=>(h(),m("div",{class:"hevue-img-help-item",key:o.keyName},[r("div",ee,I(o.keyName)+"：",1),r("div",te,I(i.shortI18n[i.locale][o.desc]),1)]))),128))],512),[[v,i.showHevueImgHelp]])]),_:1})],2),(h(),m("svg",ie,t[20]||(t[20]=[Y('<filter id="glass-distortion" x="0%" y="0%" width="100%" height="100%" filterUnits="objectBoundingBox" data-v-c87b678d><feTurbulence type="fractalNoise" baseFrequency="0.01 0.01" numOctaves="1" seed="5" result="turbulence" data-v-c87b678d></feTurbulence><feComponentTransfer in="turbulence" result="mapped" data-v-c87b678d><feFuncR type="gamma" amplitude="1" exponent="10" offset="0.5" data-v-c87b678d></feFuncR><feFuncG type="gamma" amplitude="0" exponent="1" offset="0" data-v-c87b678d></feFuncG><feFuncB type="gamma" amplitude="0" exponent="1" offset="0.5" data-v-c87b678d></feFuncB></feComponentTransfer><feGaussianBlur in="turbulence" stdDeviation="3" result="softMap" data-v-c87b678d></feGaussianBlur><feSpecularLighting in="softMap" surfaceScale="5" specularConstant="1" specularExponent="100" lighting-color="white" result="specLight" data-v-c87b678d><fePointLight x="-200" y="-200" z="300" data-v-c87b678d></fePointLight></feSpecularLighting><feComposite in="specLight" operator="arithmetic" k1="0" k2="1" k3="1" k4="0" result="litImage" data-v-c87b678d></feComposite><feDisplacementMap in="SourceGraphic" in2="softMap" scale="150" xChannelSelector="R" yChannelSelector="G" data-v-c87b678d></feDisplacementMap></filter>',1)])))],544)):k("",!0)}const ne=B(A,[["render",se],["__scopeId","data-v-c87b678d"]]);let H={};function le(e){typeof e=="string"?e={imgList:[e]}:Array.isArray(e)&&(e={imgList:e}),Object.keys(H).forEach(n=>{e[n]===void 0&&(e[n]=H[n])});const t=document.getElementById("hevue-img-preview-container");t&&t.remove();const s=document.createElement("div");s.id="hevue-img-preview-container",s.style.zIndex=e.zIndex||"9999",document.body.appendChild(s);const i=P(ne).mount(s);return Object.keys(e).map(n=>{i[n]=e[n]}),i.show(),i}export{le as p};
